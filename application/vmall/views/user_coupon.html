<html lang="zh-cn">

<head>
    <title>卡券中心</title>
    <{include file="lib/Hlink-c.html" }>
    <link href="<{TEMPLE}>css/style.css" rel="stylesheet" type="text/css">
</head>
<style>
    body{
        background: #fff;
    }
    .topnav{
        display: flex;
        background: #f7f7f7;
        border-bottom: 1px solid #e8e8e8;
    }
    .topnav a{
        width:33%;
        height:.35rem;
        line-height:.35rem;
        text-align: center;
        color: #999;
    }
    .topnav a.active{
        border-bottom: 2px solid #f60;
        color: #f60;
     }
    .nocoupon{
        width:45%;
        margin:40% auto;
        color: #ccc;
        font-size: .145rem;
        text-align: center;
        line-height:.5rem;
    }
    .content{
        padding:.13rem;
    }
    .nocoupon img{
        width:100%;
        height:auto;
    }
    .money{
        background: url("<{TEMPLE}>images/coupon_money.png");
        height:.84rem;
        background-size: 100% 100%;
        color: #fff7bb;
        position: relative;
        margin-bottom: .05rem;

    }
    .reduce{
        background: url("<{TEMPLE}>images/coupon_reduce.png");
        height:.84rem;
        background-size: 100% 100%;
        color: #fff7bb;
        position: relative;
        margin-bottom: .05rem;
    }
    .sale{
        background: url("<{TEMPLE}>images/coupon_sale.png");
        height:.84rem;
        background-size: 100% 100%;
        color: #fff7bb;
        position: relative;
        margin-bottom: .05rem;
    }
    .for_goods{
        background: url("<{TEMPLE}>images/for_goods.png");
        height:.84rem;
        background-size: 100% 100%;
        color: #333;
        position: relative;
        margin-bottom: .05rem;
    }
    .store_name{
        margin-left:.1rem;
        font-size: .12rem;
        padding-top:.05rem;
    }
    .coupon_text{
        text-align: center;
        font-size: .14rem;
    }
    .coupon_text span{
        font-size: .24rem;
    }
    .num_txt{
        font-size: .14rem!important;
    }
    .num{
        float: right;
        margin-top:.09rem;
        font-size: .14rem!important;
        padding-right:.1rem;
    }
    .coupon_bottom{
        height:.18rem;
        display: flex;
        width:100%;
        justify-content: space-between;
        align-items: center;
        position: absolute;
        bottom: 0.07rem;
    }
    .coupon_time{
        font-weight: 200;
        font-size: .105rem;
        margin-left:.1rem;
    }
    .coupon_bottom a{
        color: #fff7bb;
        margin-right:.1rem;
    }
    .for_goods .coupon_bottom a{
        color: #333;
    }
    .add{
        padding:.0rem .1rem;
        background: #000;
        color: #fff;
        border-radius: 4px;
        position: fixed;
        font-size: .18rem;
        text-align: center;
        line-height: .5rem;
        top:1rem;
        left:1rem;
        opacity: 0;
    }
    .goods_img{
        width:.32rem;
        height:.32rem;
        border-radius: 50%;
        margin-bottom: .1rem;
        margin-left: .15rem;
    }
</style>
<body>
<div class="topnav">
    <a class="active" data-id="nouse">未使用的券</a>
    <a data-id="user">已使用的券</a>
    <a data-id="overtime">已过期的券</a>
</div>
<div class="content">
    <div id="nouse">
        <!--没有优惠券的样式-->
        <{if empty($data)}><div class="nocoupon"><{else}><div class="nocoupon" style="display:none"><{/if}><img src="<{TEMPLE}>images/nownocoupon.png" alt="">您没有未使用的券</div>
        <!--红包券-->
        <!--<{foreach from=$data item=v}>-->
        <!--<{if $v[0].prize_type==3}><li class="add_prize2"><{else if $v[0].prize_type==5}><li class="add_prize4"><{else}><li><{/if}>-->
        <!--<{foreach from=$v item=vv}>-->
        <!--<input name='wheels_log_id' class="wheels_log_id" type="hidden" value="<{$vv.wheels_log_id}>" />-->
        <!--<{/foreach}>-->
            <!--<{if $v[0].prize_type==1}><a  href="<{base_url()}>vmall.php/goods/goods_info?store_id=<{$v[0]['store_id']}>&goods_id=<{$v[0].goods_id}>"><{else if $v[0].prize_type==3}><a class="reduce2"><{else if $v[0].prize_type==5}><a class="reduce4"><{/if}>-->
            <!--<div class="prize_name"><{$v[0].prize_name}>&nbsp;&nbsp;X&nbsp;&nbsp;<span class="num"><{$v[0].total}></span></div>-->
            <!--<div class="prize_img"><{if $v[0].prize_type==1}><img src="<{TEMPLE}>images/loty_p_1.png" alt=""> <{else if $v[0].prize_type==3}><img src="<{TEMPLE}>images/prize_interation.png" alt=""><{else if $v[0].prize_type==5}><img src="<{TEMPLE}>images/prize_money.png" alt=""><{/if}></div>-->
            <!--<{if $v[0].prize_type==3}> <div class="add add2"></div> <{else if $v[0].prize_type==5}> <div class="add add4"></div><{/if}>-->
        <!--</a>-->
        <!--<{/foreach}>-->
        <!--未使用的劵-->
        <{foreach from=$data item=v}>
        <{if $v[0].coupon_type==1}><div class="sale"><{else if $v[0].coupon_type==3}><div class="reduce"> <{else if $v[0].coupon_type==5}><div class="money"><{/if}>
        <{foreach from=$v item=vv}>
        <input name='wheels_log_id' class="wheels_log_id" type="hidden" value="<{$vv.user_coupon_id}>" />
        <{/foreach}>
            <input class="store_id" type="hidden" value="<{$v[0].limit_store}>">
            <input class="goods_id" type="hidden" value="<{$v[0].limit_goods}>">
            <div class="store_name"><{$v[0].store_name}></div>
            <p class="coupon_text"><{if $v[0].coupon_type==1}><span class="text_money"><{$v[0].coupon_name}></span> <img class="goods_img" src="<{$v[0].goods_image}>" onerror="javascript:this.src='<{DEFAULTIMAGE}><{$config_images.goods_image}>'" alt=""><{else if $v[0].coupon_type==3}><span class="all_money"><{$v[0].coupon_value}></span>积分劵<img class="goods_img" src="<{TEMPLE}>images/integ.png"  alt=""><{else if $v[0].coupon_type==5}><span class="text_money">红包券</span><img class="goods_img" src="<{TEMPLE}>images/redmoney.png" alt=""><{/if}>
                <span class="num">x<span class="num_txt"><{count($v)}></span></span></p>
            <div class="coupon_bottom">
                <p class="coupon_time">有效期：<{$v[0].coupon_start_time}>-<{$v[0].coupon_end_time}></p>
                <{if $v[0].coupon_type==1}><a  href="<{base_url()}>vmall.php/goods/goods_info?store_id=<{$v[0]['limit_store']}>&goods_id=<{$v[0].limit_goods}>">立即使用>></a><{else if $v[0].coupon_type==3}><a>点击领取>></a><{else if $v[0].coupon_type==5}><a>点击领取>></a><{/if}>
            </div>
        </div>
        <{/foreach}>
        <div class="add"></div>
    </div>
        <!--<div class="reduce">-->
            <!--<div class="store_name">ABC旗舰店</div>-->
            <!--<p class="coupon_text"><span class="all_money">100</span>积分劵<span class="num">x<span class="num_txt">2</span></span></p>-->
            <!--<div class="coupon_bottom">-->
                <!--<p class="coupon_time">有效期：2017.09.01-2017.09.30</p>-->
                <!--<a href="javascript:;">立即使用>></a>-->
            <!--</div>-->
        <!--</div>-->
        <!--折扣券-->
        <!--<div class="sale">-->
            <!--<div class="store_name">ABC旗舰店</div>-->
            <!--<p class="coupon_text"><span class="text_money">8.5折</span>折扣券 <span class="num">x<span class="num_txt">2</span></span></p>-->
            <!--<div class="coupon_bottom">-->
                <!--<p class="coupon_time">有效期：2017.09.01-2017.09.30</p>-->
                <!--<a href="javascript:;">立即使用>></a>-->
            <!--</div>-->
        <!--</div>-->
        <!--指定商品券-->
        <!--<div class="for_goods">-->
            <!--<div class="store_name">ABC旗舰店</div>-->
            <!--<p class="coupon_text">指定商品<span class="text_money" style="color: #de4b3f;">99</span><span style="color: #de4b3f;font-size: .14rem">元</span> <span class="num">x<span class="num_txt">2</span></span></p>-->
            <!--<div class="coupon_bottom">-->
                <!--<p class="coupon_time">有效期：2017.09.01-2017.09.30</p>-->
                <!--<a href="javascript:;">立即使用>></a>-->
            <!--</div>-->
        <!--</div>-->
    <!--</div>-->
    <div id="user" style="display: none">
        <{if empty($open_data)}><div class="nocoupon"><{else}><div class="nocoupon" style="display:none"><{/if}><img src="<{TEMPLE}>images/nownocoupon.png" alt="">您没有使用过券</div>
        <{foreach from=$open_data item=v}>
        <div class="money <{$v[0].limit_store}>" style="opacity: 0.5">
            <{if $v[0].coupon_type==1}><div class="sale"><{else if $v[0].coupon_type==3}><div class="reduce"> <{else if $v[0].coupon_type==5}><div class="money"><{/if}>
            <{foreach from=$v item=vv}>
            <input name='wheels_log_id' class="wheels_log_id" type="hidden" value="<{$vv.user_coupon_id}>" />
            <{/foreach}>
            <div class="store_name"><{$v[0].store_name}></div>
            <p class="coupon_text"><{if $v[0].coupon_type==1}><span class="text_money"><{$v[0].coupon_name}></span><img class="goods_img" src="<{$v[0].goods_image}>" onerror="javascript:this.src='<{DEFAULTIMAGE}><{$config_images.goods_image}>'" alt=""><{else if $v[0].coupon_type==3}><span class="all_money"><{$v[0].coupon_value}></span>积分劵<img class="goods_img" src="<{TEMPLE}>images/integ.png" alt=""><{else if $v[0].coupon_type==5}><span class="text_money">红包券</span><img class="goods_img" src="<{TEMPLE}>images/redmoney.png" alt=""><{/if}> <span class="num">x<span class="num_txt"><{count($v)}></span></span></p>
            <div class="coupon_bottom">
                <p class="coupon_time">有效期：<{$v[0].coupon_start_time}>-<{$v[0].coupon_end_time}></p>
                <a class="del_user" href="javascript:void(0);">删除</a>
                <input class="store" type="hidden" value="<{$v[0].limit_store}>">
            </div>
        </div>
        </div>
            <{/foreach}>
    </div>
    <div id="overtime" style="display: none">
        <{if empty($user_data)}><div class="nocoupon"><{else}><div class="nocoupon" style="display:none"><{/if}><img src="<{TEMPLE}>images/nownocoupon.png" alt="">您没有已过期的券</div>
        <{foreach from=$user_data item=v}>
        <div class="money <{$v[0].limit_store}>" style="opacity:0.5">
            <{if $v[0].coupon_type==1}><div class="sale"><{else if $v[0].coupon_type==3}><div class="reduce"> <{else if $v[0].coupon_type==5}><div class="money"><{/if}>
            <{foreach from=$v item=vv}>
            <input name='wheels_log_id' class="wheels_log_id" type="hidden" value="<{$vv.user_coupon_id}>" />
            <{/foreach}>
            <div class="store_name"><{$v[0].store_name}></div>
            <p class="coupon_text"><{if $v[0].coupon_type==1}><span class="text_money"><{$v[0].coupon_name}></span> <img class="goods_img" src="<{$v[0].goods_image}>" onerror="javascript:this.src='<{DEFAULTIMAGE}><{$config_images.goods_image}>'" alt=""><{else if $v[0].coupon_type==3}><span class="all_money"><{$v[0].coupon_value}></span>积分劵<img class="goods_img" src="<{TEMPLE}>images/integ.png" alt=""><{else if $v[0].coupon_type==5}><span class="text_money">红包券</span><img class="goods_img" src="<{TEMPLE}>images/redmoney.png" alt=""><{/if}> <span class="num">x<span class="num_txt"><{count($v)}></span></span></p>
            <div class="coupon_bottom">
                <p class="coupon_time">有效期：<{$v[0].coupon_start_time}>-<{$v[0].coupon_end_time}></p>
                <a class="del_overtime" href="javascript:void(0);">删除</a>
                <input class="store" type="hidden" value="<{$v[0].limit_store}>">
            </div>
        </div>
            <!--<div class="store_name">ABC旗舰店</div>-->
            <!--<p class="coupon_text"><span class="text_money">88</span>元红包券 <span class="num">x<span class="num_txt">2</span></span></p>-->
            <!--<div class="coupon_bottom">-->
                <!--<p class="coupon_time">有效期：2017.09.01-2017.09.30</p>-->
                <!--<a href="javascript:;">立即使用>></a>-->
            <!--</div>-->
        </div>
            <{/foreach}>
    </div>
</body>
<script src="<{TEMPLE}>js/jquery-2.1.1.js"></script>
<script>
    $('.topnav a').click(function () {
        $('.topnav a').removeClass('active');
        $(this).addClass('active');
        $('.content>div').hide();
        $("#"+$(this).attr('data-id')).show();
    })

    $('.del_user').on('click',function(){//点击删除已使用的同店铺劵
       if(confirm('确定删除此店铺下所有已使用的劵吗？'))
        {
            var store_id = $(this).next('.store').val();
            $('#user').find('.'+store_id).remove();
            $.ajax({
                url: 'delCoupon',
                type: 'post',
                data: {'store_id': store_id, 'del_type': 'user'},
                async: true,
                success: function (data) {

                }
            });
        }
    })

    $('.del_overtime').on('click',function(){//点击删除已过期的同店铺劵
        if(confirm('确定删除此店铺下所有过期劵吗？'))
        {
            var store_id = $(this).next('.store').val();
            $('#overtime').find('.'+store_id).remove();
            $.ajax({
                url: 'delCoupon',
                type: 'post',
                data: {'store_id': store_id, 'del_type': 'overtime'},
                async: true,
                success: function (data) {

                }
            });
        }
    })

    $('#nouse .sale').on('click',function(){//点击劵进入商店
        var store_id=$(this).find('.store_id').val();
        var goods_id=$(this).find('.goods_id').val();
//        alert(store_id);alert(goods_id);
        window.location.href="<{base_url('vmall.php/goods/goods_info?store_id="+store_id+"&goods_id=')}>"+goods_id;
    })

        $('#nouse .reduce').on('click',function(){//点击积分
            var num=$(this).find('.num_txt').html()-1;
            if(num<1){
                num=0;
                $(this).css({'opacity':'0.5'});
            }
            $(this).find('.num_txt').html(num);
            var wheels_log_id=$(this).find("input:first-child").val();//当前使用的积分的wheels_log_id
            $(this).find("input:first-child").remove();//将已开启的积分信息删除
            $.ajax({
                url:'getPoint',
                type:'post',
                data:{'wheels_log_id':wheels_log_id},
                dataType:'json',
                async:true,
                success:function(data){
                    if(data['rel']) {
                        $(".add").html("积分+" + data['point']);
                        $(".add").css({'opacity': '1', 'top': '1rem','display':'block'});
                        $(".add").animate({top: '.1rem', opacity: '0', padding: '0.04rem 0.1rem'},1000,function(){
                            $(".add").hide()
                        });
                    }

                }
            })
        })

        $('#nouse .money').on('click',function(){//点击红包
            var num=$(this).find('.num_txt').html()-1;
            if(num<1){
                num=0;
                $(this).css({'opacity':'0.5'});
            }
            $(this).find('.num_txt').html(num);
            var wheels_log_id=$(this).find("input:first-child").val();//当前使用的红包的wheels_log_id
            $(this).find("input:first-child").remove();//将已开启的红包信息删除
            $.ajax({
                url:'getCash',
                type:'post',
                data:{'wheels_log_id':wheels_log_id},
                dataType:'json',
                async:true,
                success:function(data){
                    if(data['rel']){
                        $(".add").html("零钱+"+data['prize_value']);
                        $(".add").css({'opacity':'1','top':'1rem','display':'block'});
                        $(".add").animate({top:'.1rem',opacity:'0',padding:'0.04rem 0.1rem'},1000,function(){$(".add").hide()});
                    }
                }
            })
        })





</script>
</html>